# 被动信息收集

## 被动信息收集概述和目的

信息收集的方式可以分为两种：被动和主动

被动信息收集方式是指利用第三方的服务对目标进行访问了解，例如：Google搜索

主动的信息收集方式：通过直接访问、扫描网站，这种将流量流经网站的行为。比如：nmap扫描端口

被动信息收集的目的：通过公开渠道，去获得目标主机的信息，从而补与目标系统直接交互，避免留下痕迹

## 信息收集内容

1. IP地址段
2. 域名信息
3. 邮件地址
4. 文档图片数据
5. 公司地址
6. 公司组织架构
7. 联系电话/传真号码
8. 人员信息/职务
9. 目标系统使用的技术架构
10. 公开的商业信息

## 信息用途

1. 信息描述目标
2. 发现目标
3. 社会工程学攻击
4. 物理缺口

# DNS信息收集

## 域名解析原理

1. DNS服务器概述：

   运行DNS服务器程序的计算机，存储DNS数据库信息。DNS服务器分为根域DNS服务器、顶级域名DNS服务器。根域DNS服务器有13个，都存储了全部的顶级域名服务器所在地址；顶级域名服务器存储了每位客户所注册的主机地址，这里对应到163.com.这个级别。

2. 域名记录

   * A（Adress）正向解析

     A记录是将一个主机名（全称域名FQDN）和一个IP地址关联起来。这也是大多数客户端程序默认的查询类型。例如：xuegod.cn -> 8.8.8.6

   * PTR记录（Pointer）反向解析

     PTR记录将一个IP地址对应到主机名（全称域名FQDN）。这些记录保存在in-addr.arpa域中。

   * CNAME记录（Canonical Name）别名

     别名记录，也称为规范名字。这种记录允许您将多个名字映射到同一台计算机。

     例如：www.xuegod.cn对应IP8.8.8.6，web.xuegod.cn对应IP8.8.8.6

   * MX记录（Mail eXchange）

     MX记录是邮箱交换记录，它指向一个邮箱服务器，用于电子邮件系统发邮件时根据收信人的地址后缀来定位邮件服务器

     例如：mail.xuegod.cn

     当有多个MX记录（即有多个邮件服务器）时，则需要设置数值来确定其优先级。通过设置优先级数字来指明首选服务器，数字越小表示优先级越高。

   * NS记录（Name Server）

     NS（Name Server）记录是域名服务器记录，也称为授权服务器，用来指定该域名由哪个DNS服务器来进行解析。

     例如：dns.xuegod.cn
   
   ## DNS缓存服务器
   
   缓存DNS服务器：不负责解析域，只是缓存域名解析结果
   
   DNS查询方式：递归查询和迭代查询

## ping指令

![image-20231217102440579](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217102440579.png)

## nslookup指令

查看百度

![image-20231216234056132](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20231216234056132.png)

## dig指令

**dig （选项） 需要查询的域名**

![image-20231217102716013](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217102716013.png)

@\<DNS服务器地址>：指定进行域名解析的域名服务器

![image-20231217102803418](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217102803418.png)

any #显示所有类型的域名记录。默认只显示A记录

![image-20231217102829644](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217102829644.png)

-x 参数IP反查域名

![image-20231217103023071](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217103023071.png)

![image-20231217103057072](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217103057072.png)

查询DNS服务器bind版本信息

![image-20231217103301184](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217103301184.png)

# 使用Maltego收集子域名信息

## 顶级域名

顶级域名是域名的最后一个部分，即是域名最后一点之后的字母，例如在http://example.com这个域名中，顶级域是.com

1. 通用顶级类别域名共6个，包括用于科研机构的.ac；用于工商金融企业的.com；用于教育机构的.edu；用于政府部门的.gov；用于互联网络信息中心和运行中心的.net；用于非盈利组织的.org。
2. 国家及地区顶级域，如.cn代表中国，.uk代表英国等。

## 子域名

凡顶级域名前加前缀的都是该顶级域名的子域名，而子域名根据技术的多少分为二级子域名，三级子域名以及多级子域名。

## 挖掘子域名的重要性

子域名是某个主域的二级域名或者多级域名，在防御措施严密的情况下无法直接拿下主域，那么就可以采用迂回战术拿下子域名，然后无限靠近主域。

例如：www.xxxxx.com主域不存在漏洞，并且防护措施严密。而二级域名edu.xxxxx.com存在漏洞，并且防护措施松散

1. 子域名挖掘工具：Maltego子域名挖掘机
2. 搜索引擎挖掘，如：在Google中输入site:qq.com
3. 第三方网站查询：http://tool.chinaz.com/subdomain、https://dnsdumpster.com/
4. 证书透明度公开日志枚举：https://crt.sh/、http://censys.io/
5. 其它途径：https://phpinfo.me/domain、http://dns.aizhan.com

## 使用Maltego CE进行子域名挖掘

先翻墙后，再注册，因为注册过程的验证码是google技术，不翻墙使用不了。

Maltego CE官网：https://www.paterva.com/web7/buy/maltego-clients/maltego-ce.php

注册账号网址：https://www.paterva.com/web7/community/community.php

# Shodan介绍

Shodan搜索引擎是一款“黑暗”谷歌，是互联网上最可怕的搜索引擎

shodan官网：https://www.shodan.io

# Google搜索引擎的使用技巧

|   语法   |           用法           |
| :------: | :----------------------: |
|   site   |         指定域名         |
|  inurl   |  URL中存在的关键字页面   |
|  intext  |   网页内容里面的关键字   |
| Filetype |       指定文件类型       |
| intitle  |    网页标题中的关键字    |
|   link   | 返回你所有的指定域名链接 |
|   info   |     查找指定站点信息     |
|  cache   |  搜索Google里的内容缓存  |

* **site**:xuegod.cn

  site:.jp

  site:.uk

  site:.com

  site:.net

* **inurl**:qq.txt

  inurl:admin.php

  inurl:admin_login.php

* intitle:后台登录

  intitle:index.of.bash_history

  * index.of表示包含index.of字段，出现该字段表示网站目录是对我们开放的，我们可以查看到网站目录下的所有文件信息
  * .bash_history表示我们要筛选的文件名称，也可以替换成其他的敏感信息文件，该文件记录了用户的历史命令记录

  查找discuz论坛中存储mysql密码的配置文件config_global.php

* cache返回的结果是被搜索引擎收录时的页面，比如一些页面被删除了，我们可以通过cache还是可以访问。

  cache:xuegod.cn

* filetype:torrent kail

  * Kail是我们要搜索的关键字
  * filetype指定文件类型
  * torrent文件类型名称，torrent是种子文件，可以填写任意扩展名

  filetype:pdf 渗透安全

* apache site:bbs.xuegod.cn

  apache是我们搜索的关键字

  site可查询网站的收录情况

  bbs.xuegod.cn目标网站：学神官方论坛

* intext:user.sql intitle:index.of 组合使用技巧

  intext:user.sql查询包含user.sql用户数据库信息的页面

  intitle:index.of表示网站目录是开放状态

# 常见最新漏洞公布网站

美国著名安全公司 Offensive Security的漏洞库http://www.exploit-db.com（比较及时）

赛门铁克的漏洞库http://www.securityfocus.com（国际权威漏洞库）

国家信息安全漏洞共享平台http://www.cnvd.org.cn/

国内安全厂商——绿盟科技http://www.nsfocus.net

俄罗斯知名安全实验室http://www.securitylab.ru/vulnerability/

CVE常见漏洞和纰漏http://cve.mitre.org

信息安全漏洞门户http://vulhub.org.cn/index

安全客https://www.anquanke.com/

美国国家信息安全漏洞库https://nvd.nist.gov/

知道创宇漏洞库https://www.seebug.org/

# 主动信息收集

## 特点

1. 直接与目标系统交互通信
2. 无法避免留下访问的痕迹
3. 使用受控的第三方电脑进行探测，使用代理或已经被控制的机器，做好被封杀的准备
4. 扫描发送不同的探测，根据返回结果判断目标状态

## 发现目标主机的过程

1. 识别存活主机，发现潜在的被攻击目标
2. 输出一个IP地址列表比如IP地址段IP地址范围
3. 使用二、三、四层进行探测发现

# 基于ping命令的探测

ping命令是我们常用的判断主机之间网络是否畅通，同样也是能判断我们的目标主机是否存活

![image-20231217121243775](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217121243775.png)

我们从当前主机到目标主机之间肯定要经过很多网络设备，我们怎么才能知道中间经过了哪些网络设备？

答案是使用traceroute命令

![image-20231217130019386](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217130019386.png)

ping命令延伸出了很多其他的命令，如ARPING、FPING、HPING等

* ARPING：Address Resolution Protocol（地址解析协议）

  ![image-20231217130435883](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217130435883.png)

  ![image-20231217130611574](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217130611574.png)

  使用arping命令可以查看局域网中的IP是否有冲突

  ![image-20231217132014074](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217132014074.png)

  * grep过滤含有“bytes from”的一行
  * cut分割，-d参数是指定以哪个为分隔符，-f是指定分割之后的哪一行

  ![image-20231217132517707](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217132517707.png)

  shell脚本实现对网络的自动扫描

  ![image-20231217133112533](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217133112533.png)

  使用netdiscover进行被动方式探测局域中存活的机器

  ![image-20231217133408807](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217133408807.png)

* HPING3

  hping3是一个命令行下使用的TCP/IP数据包组装/分析工具，通常web服务会用来做压力测试使用，也可以进行DOS攻击的实验。同样Hping只能每次扫描一个目标

  ![image-20231217133726790](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217133726790.png)

* FPING

  FPING就是ping命令的加强版，它可以对一个IP段进行ping命令扫描，而ping命令本身是不可以对网段进行扫描的

  ![image-20231217143508277](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217143508277.png)

# 基于nmap的扫描方式

Network Mapper

![image-20231217143655099](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217143655099.png)

nmap的扫描类型主要有TCP的全连接扫描（会在被扫描机器上留下记录），半连接扫描（不会留下记录）

![image-20231217143930897](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217143930897.png)

![image-20231217144019337](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217144019337.png)

## 使用nc扫描端口

![image-20231217144052267](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217144052267.png)

![image-20231217144104467](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217144104467.png)

![image-20231217144206707](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217144206707.png)

# 使用scapy定制数据包进行高级扫描

scapy是一个可以让用户发送、侦听和解析并伪装网络报文的Python程序。这些功能可以用于制作侦测、扫描和攻击网络的工具

## scapy定制ARP协议

kali输入scapy进入界面

![image-20231217144509363](C:/Users/Administrator/AppData/Roaming/Typora/typora-user-images/image-20231217144509363.png)

![image-20231221131940827](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20231221131940827.png)

## scapy定制PING包

![image-20231221132110756](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20231221132110756.png)

![image-20231221132150233](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20231221132150233.png)

IP()生成ping包的源IP和目标IP，ICMP()生成ping包的类型。使用IP()和ICMP()两个函数，可生成ping包，进行探测。

![image-20231221132754723](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20231221132754723.png)

## scapy定制TCP协议SYN请求

![image-20231221132853071](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20231221132853071.png)

![image-20231221132925760](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20231221132925760.png)

![image-20231221133150220](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20231221133150220.png)

![image-20231221133241355](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20231221133241355.png)

# 僵尸扫描

